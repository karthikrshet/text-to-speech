<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Text to Speech</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body {
      background: linear-gradient(135deg, #74ABE2, #5563DE);
      min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
      transition: background 0.4s ease; padding: 24px;
    }
    .container {
      background: rgba(255,255,255,0.15); backdrop-filter: blur(15px);
      padding: 26px; border-radius: 16px; text-align: center; width: min(980px, 100%);
      box-shadow: 0 8px 32px rgba(0,0,0,0.2); animation: fadeIn 0.8s ease-in-out;
    }
    h1 { color: #fff; font-size: 34px; margin-bottom: 14px; }
    p.sub { color: #eef; opacity: .9; margin-bottom: 16px; font-size: 14px; }
    .row { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: center; margin-bottom: 12px; }
    select, button, input[type="text"], textarea {
      padding: 10px 12px; border: none; border-radius: 8px; font-size: 14px;
    }
    select, input[type="text"] { min-width: 220px; }
    textarea {
      width: 100%; min-height: 180px; resize: vertical; background: rgba(255,255,255,0.9);
      border-radius: 12px; padding: 14px; line-height: 1.6; color: #111; text-align: left;
      box-shadow: inset 0 1px 6px rgba(0,0,0,0.08);
    }
    .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; margin-top: 12px; }
    .control { color: #fff; text-align: left; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 10px; }
    .control label { display: block; font-size: 12px; opacity: 0.9; margin-bottom: 6px; }
    .control .value { font-weight: 600; margin-left: 6px; }
    button {
      color: white; background: #ff7b54; cursor: pointer; transition: transform 0.2s, background 0.3s;
    }
    button:hover { background: #ff5722; transform: translateY(-1px); }
    button.secondary { background: rgba(255,255,255,0.25); color: #fff; }
    button.secondary:hover { background: rgba(255,255,255,0.35); }
    button.ghost { background: transparent; border: 2px solid rgba(255,255,255,0.4); }
    button.ghost:hover { background: rgba(255,255,255,0.18); }
    .status { margin: 10px 0 6px; font-weight: 600; color: #fff; }
    .warn { color: #ffe08a; font-size: 13px; margin: 6px 0; }
    .theme-toggle { margin-top: 14px; color: #fff; cursor: pointer; font-size: 13px; text-decoration: underline; }
    footer { margin-top: 18px; color: #fff; font-size: 14px; text-align: center; }
    footer strong { color: #ffdd57; transition: color 0.3s; cursor: pointer; }
    footer strong:hover { color: #fff; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    /* Dark mode */
    .dark textarea { background: rgba(20,20,20,0.85); color: #f1f1f1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Text to Speech</h1>
    <p class="sub">Type or paste text, pick a voice, then click <b>Speak</b>. You can pause/resume, and even record tab audio to a file.</p>

    <div class="row">
      <select id="voiceSelect" title="Voice"></select>
      <button id="refreshVoices" class="secondary">‚Üª Refresh Voices</button>
    </div>

    <textarea id="text" placeholder="Type your text here‚Ä¶">Hello! This is a sample. Change the voice, rate, pitch, and volume, then click Speak.</textarea>

    <div class="controls">
      <div class="control">
        <label>Rate <span class="value" id="rateVal">1.0</span></label>
        <input id="rate" type="range" min="0.5" max="2" step="0.1" value="1"/>
      </div>
      <div class="control">
        <label>Pitch <span class="value" id="pitchVal">1.0</span></label>
        <input id="pitch" type="range" min="0" max="2" step="0.1" value="1"/>
      </div>
      <div class="control">
        <label>Volume <span class="value" id="volVal">1.0</span></label>
        <input id="volume" type="range" min="0" max="1" step="0.05" value="1"/>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button id="speakBtn">‚ñ∂ Speak</button>
      <button id="pauseBtn" class="secondary">‚è∏ Pause</button>
      <button id="resumeBtn" class="secondary">‚èØ Resume</button>
      <button id="stopBtn" class="secondary">‚èπ Stop</button>
    </div>

    <div class="row" style="margin-top:10px;">
      <button id="downloadTextBtn" class="ghost">‚¨á Download Text</button>
      <button id="recordBtn" class="ghost">‚è∫ Record to Audio (WEBM)</button>
      <button id="stopRecordBtn" class="ghost">‚ñ† Stop Recording</button>
    </div>

    <div id="status" class="status">Idle</div>
    <div id="warn" class="warn" style="display:none;"></div>
    <div class="theme-toggle" id="toggleTheme">Switch Theme</div>
  </div>

  <footer>
    Developed by <strong>Karthik Shet</strong>
  </footer>

  <script>
    // Theme toggle
    const themeToggle = document.getElementById("toggleTheme");
    let darkMode = false;
    themeToggle.addEventListener("click", () => {
      darkMode = !darkMode;
      document.body.classList.toggle("dark", darkMode);
      document.body.style.background = darkMode
        ? "linear-gradient(135deg, #1f1f1f, #3a3a3a)"
        : "linear-gradient(135deg, #74ABE2, #5563DE)";
    });

    const textEl = document.getElementById("text");
    const voiceSelect = document.getElementById("voiceSelect");
    const refreshVoices = document.getElementById("refreshVoices");
    const rate = document.getElementById("rate"); const rateVal = document.getElementById("rateVal");
    const pitch = document.getElementById("pitch"); const pitchVal = document.getElementById("pitchVal");
    const volume = document.getElementById("volume"); const volVal = document.getElementById("volVal");
    const speakBtn = document.getElementById("speakBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const resumeBtn = document.getElementById("resumeBtn");
    const stopBtn = document.getElementById("stopBtn");
    const downloadTextBtn = document.getElementById("downloadTextBtn");
    const recordBtn = document.getElementById("recordBtn");
    const stopRecordBtn = document.getElementById("stopRecordBtn");
    const statusEl = document.getElementById("status");
    const warnEl = document.getElementById("warn");

    // Web Speech Synthesis
    const synth = window.speechSynthesis;
    let voices = [];
    let currentUtterance = null;

    function setStatus(s){ statusEl.textContent = s; }

    function populateVoices() {
      const list = synth.getVoices();
      if (!list.length) return; // will be called again on voiceschanged
      voices = list.slice().sort((a,b) => a.name.localeCompare(b.name));
      voiceSelect.innerHTML = "";
      voices.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v.name;
        opt.textContent = `${v.name} (${v.lang})${v.default ? " ‚Äî default" : ""}`;
        voiceSelect.appendChild(opt);
      });
      // Try set a sensible default
      const firstEn = voices.find(v => v.lang.toLowerCase().startsWith("en"));
      if (firstEn) voiceSelect.value = firstEn.name;
    }

    function ensureSupport() {
      if (!("speechSynthesis" in window) || !("SpeechSynthesisUtterance" in window)) {
        warnEl.style.display = "block";
        warnEl.innerHTML = "‚ö†Ô∏è Your browser doesn‚Äôt support Speech Synthesis. Try Chrome/Edge/Safari.";
        speakBtn.disabled = pauseBtn.disabled = resumeBtn.disabled = stopBtn.disabled = true;
        return false;
      }
      return true;
    }

    // Event wiring
    if (ensureSupport()) {
      populateVoices();
      window.speechSynthesis.onvoiceschanged = populateVoices;
    }

    rate.addEventListener("input", () => rateVal.textContent = Number(rate.value).toFixed(2));
    pitch.addEventListener("input", () => pitchVal.textContent = Number(pitch.value).toFixed(2));
    volume.addEventListener("input", () => volVal.textContent = Number(volume.value).toFixed(2));

    refreshVoices.addEventListener("click", populateVoices);

    function speak(text) {
      if (!text || !text.trim()) return;
      if (synth.speaking) synth.cancel(); // reset
      const utter = new SpeechSynthesisUtterance(text.trim());
      currentUtterance = utter;

      const v = voices.find(v => v.name === voiceSelect.value);
      if (v) utter.voice = v;
      utter.rate = Number(rate.value);
      utter.pitch = Number(pitch.value);
      utter.volume = Number(volume.value);

      utter.onstart = () => setStatus("üîä Speaking‚Ä¶");
      utter.onend = () => setStatus("Done");
      utter.onerror = (e) => setStatus("‚ö†Ô∏è Error: " + (e.error || "unknown"));

      synth.speak(utter);
    }

    speakBtn.addEventListener("click", () => speak(textEl.value));
    pauseBtn.addEventListener("click", () => { if (synth.speaking && !synth.paused) { synth.pause(); setStatus("‚è∏ Paused"); } });
    resumeBtn.addEventListener("click", () => { if (synth.paused) { synth.resume(); setStatus("üîä Speaking‚Ä¶"); } });
    stopBtn.addEventListener("click", () => { if (synth.speaking || synth.paused) { synth.cancel(); setStatus("Stopped"); } });

    // Download text as .txt
    downloadTextBtn.addEventListener("click", () => {
      const txt = (textEl.value || "").trim();
      if (!txt) return;
      const blob = new Blob([txt], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = `tts_text_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.txt`;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    // --- Experimental: Record tab audio while speaking (WEBM) ---
    let mediaRecorder = null;
    let recordedChunks = [];

    async function startRecording() {
      /*
        This prompts for a screen/tab share. To capture the **tab‚Äôs audio**:
        - Choose ‚ÄúChrome Tab‚Äù (or your browser‚Äôs tab option)
        - Select THIS tab
        - Tick ‚ÄúShare tab audio‚Äù
      */
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
        // Some browsers require stopping the video track to avoid sharing the screen preview;
        // but keep audio for recording. We'll hide video by not attaching it anywhere.
        mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm;codecs=vp9,opus" });
        recordedChunks = [];
        mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) recordedChunks.push(e.data); };
        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" }); // contains audio track
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = `tts_audio_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.webm`;
          document.body.appendChild(a); a.click(); a.remove();
          URL.revokeObjectURL(url);
          // Stop all tracks
          stream.getTracks().forEach(t => t.stop());
          setStatus("üéß Recording saved");
        };
        mediaRecorder.start();
        setStatus("‚è∫ Recording‚Ä¶ (remember to Share tab audio)");
      } catch (err) {
        setStatus("‚ö†Ô∏è Recording blocked or canceled");
      }
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
      }
    }

    recordBtn.addEventListener("click", startRecording);
    stopRecordBtn.addEventListener("click", stopRecording);

    // Tip banner for HTTPS
    if (location.protocol !== "https:" && location.hostname !== "localhost") {
      warnEl.style.display = "block";
      warnEl.innerHTML = "‚ÑπÔ∏è On most browsers, audio capture requires HTTPS. Host this page on https:// (GitHub Pages works great).";
    }
  </script>
</body>
</html>
